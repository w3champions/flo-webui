import { Spinner } from "../components/Spinner";
import { useState } from "react";
import { SerializedError } from "@reduxjs/toolkit";
import { useApiClient } from "../helpers/api-client";
import { Alert } from "../components/Alert";
import { Button } from "@blueprintjs/core";
import { useDispatch } from "react-redux";
import { signOut } from "../redux/modules/auth";
import { FlagIcon } from "./FlagIcon";

export default function SignIn() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<SerializedError>(null);
  const client = useApiClient();
  const handleSignIn = async (region: string) => {
    setLoading(true);
    setError(null);

    try {
      const { url } = await client
        .get("/api/oauth-get-authorize-url", {
          params: {
            region
          }
        })
        .then((res) => res.data);
      window.location.href = url;
    } catch (e) {
      setError(e);
      setLoading(false);
    }
  };

  return (
    <>
      {error && <Alert message={error.message} />}
      {loading && <Spinner />}
      {!loading && (
        <>
        <Button
          onClick={() => handleSignIn("global")}
          intent="primary"
          large
          icon={
            <svg
              fill="#ffffff"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 32 32"
              width="16px"
              height="16px"
            >
              <path d="M 14.367188 1.0117188 C 13.557187 0.92071875 13.039719 1.35425 12.761719 1.65625 C 11.753719 2.74225 11.335875 4.5200313 11.296875 6.5820312 C 10.872875 5.8580312 10.290953 5.1385 9.6269531 5.0625 L 9.6152344 5.0625 C 8.4052344 4.8595 7.3678125 6.7751719 7.5078125 9.8261719 C 5.2598125 9.9071719 3.3475938 10.163375 2.0585938 10.484375 C 1.4785937 10.628375 1.1085781 10.910687 1.0175781 11.054688 C 1.0765781 11.032687 2.3306875 10.515625 7.5546875 10.515625 C 7.8606875 13.621625 9.2961719 16.480609 9.0761719 15.974609 C 8.5061719 16.876609 6.8356875 19.628219 6.3046875 21.699219 C 5.9606875 23.040219 6.0494531 23.904891 6.3144531 24.462891 C 6.6404531 25.209891 7.2768281 25.44125 7.6738281 25.53125 C 9.1388281 25.86625 10.918906 25.318969 12.753906 24.292969 C 12.312906 25.044969 11.939656 25.963656 12.222656 26.597656 C 12.650656 27.748656 14.829297 27.691922 17.404297 26.044922 C 18.586297 27.930922 19.751969 29.438719 20.667969 30.386719 C 20.817969 30.548719 20.991641 30.689734 21.181641 30.802734 C 21.482641 30.991734 21.683594 31 21.683594 31 C 21.200594 30.604 19.692531 28.772094 18.019531 25.621094 C 19.321531 24.683094 20.694656 23.3435 21.972656 21.5625 C 29.169656 21.8325 30.368531 20.111984 30.644531 19.708984 C 31.504531 18.543984 30.845156 16.344703 27.285156 14.220703 C 28.859156 14.231703 29.369406 13.784141 29.566406 13.494141 C 30.297406 12.538141 29.153703 10.705453 26.470703 9.3144531 C 27.511703 7.3464531 28.168203 5.7787187 28.533203 4.5117188 C 28.731203 3.8187187 28.598547 3.3982188 28.560547 3.3242188 C 28.459547 3.9402188 27.696781 5.9691875 25.800781 8.9921875 C 24.335781 8.3351875 22.488641 7.8146562 20.306641 7.5976562 C 19.782641 6.6046562 18.263672 3.8557187 16.763672 2.3867188 C 15.776672 1.4167187 14.985141 1.0617188 14.369141 1.0117188 L 14.367188 1.0117188 z M 15.853516 4.296875 C 16.914147 4.4561511 18.877656 7.3698438 18.964844 7.5039062 C 16.353844 7.4069062 14.653016 7.9388437 13.416016 8.7148438 C 13.533016 5.6498438 14.664297 4.2387344 15.654297 4.3027344 C 15.716172 4.2872344 15.782807 4.2862566 15.853516 4.296875 z M 10.457031 6.8886719 L 10.462891 6.8886719 C 10.799891 6.9536719 11.086594 7.2935469 11.308594 7.6855469 C 11.336594 8.3955469 11.401094 9.1281406 11.496094 9.8691406 C 10.643094 9.8191406 9.8117187 9.7959219 9.0117188 9.7949219 C 9.0067187 9.9849219 9.0040312 6.8066719 10.457031 6.8886719 z M 18.189453 8.4140625 C 20.801453 8.5700625 23.249859 9.3078906 25.005859 10.212891 C 24.587859 10.824891 24.132672 11.458234 23.638672 12.115234 C 22.423672 9.9052344 20.869391 9.5456875 20.775391 9.5546875 C 20.781391 9.5546875 22.293984 10.377313 23.208984 12.320312 C 21.011984 11.514313 18.751172 10.892891 16.451172 10.462891 C 15.685172 10.320891 14.915578 10.203375 14.142578 10.109375 C 14.138578 10.135375 14.036625 10.217781 14.015625 11.300781 C 18.578625 12.149781 22.022453 13.637344 23.814453 14.652344 C 23.857453 16.032344 23.408172 17.676453 22.326172 19.314453 C 20.884172 21.501453 19.020422 23.254312 17.357422 24.320312 C 17.034422 23.655313 16.712625 22.943547 16.390625 22.185547 C 18.924625 22.259547 20.048609 21.087281 20.099609 20.988281 C 20.099609 20.992281 18.634547 21.905031 16.435547 21.707031 C 18.230547 20.208031 19.897922 18.561156 21.419922 16.785156 C 21.929922 16.187156 22.416859 15.579891 22.880859 14.962891 C 22.859859 14.945891 22.789109 14.786766 21.912109 14.259766 C 18.883109 17.791766 15.915766 20.000781 14.134766 21.050781 C 12.928766 20.395781 11.742094 19.188266 10.871094 17.447266 C 9.6990937 15.108266 9.1134844 12.619484 9.0214844 10.646484 C 9.7424844 10.699484 10.501875 10.773047 11.296875 10.873047 C 9.990875 13.029047 10.453813 14.565672 10.507812 14.638672 C 10.507812 14.634672 10.4515 12.928484 11.6875 11.146484 C 12.2145 14.222484 13.092688 17.228516 14.304688 20.103516 C 14.358688 20.081516 14.412438 20.154141 15.398438 19.619141 C 13.855438 15.255141 13.42025 11.523031 13.40625 9.4570312 C 14.57825 8.7290313 16.229453 8.2980625 18.189453 8.4140625 z M 25.742188 10.632812 C 28.031187 12.044812 28.431641 13.747781 26.306641 13.675781 C 25.703641 13.362781 25.067156 13.070922 24.410156 12.794922 C 24.876156 12.087922 25.320188 11.366812 25.742188 10.632812 z M 24.449219 15.033203 C 26.081219 16.063203 27.214219 17.235469 27.324219 18.480469 C 27.391219 19.237469 26.850609 20.186359 22.724609 20.443359 C 24.119609 18.233359 24.501219 16.472203 24.449219 15.033203 z M 9.6640625 17.177734 C 10.880062 19.503734 12.200328 20.726062 13.486328 21.414062 C 10.744328 22.865063 8.9447187 22.585734 8.5117188 21.677734 C 8.5007188 21.665734 7.8590625 20.782734 9.6640625 17.177734 z M 15.419922 22.515625 C 15.810922 23.296625 16.216953 24.044906 16.626953 24.753906 C 14.247953 26.034906 12.592984 25.501797 13.708984 23.716797 C 14.280984 23.351797 14.852922 22.947625 15.419922 22.515625 z" />
            </svg>
          }
        >
          Sign In with Blizzard
        </Button>
        <br /><br />
        <Button
          onClick={() => handleSignIn("china")}
          intent="primary"
          large
          icon={
            <svg
              fill="#ffffff"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 32 32"
              width="16px"
              height="16px"
            >
              <path d="M 14.367188 1.0117188 C 13.557187 0.92071875 13.039719 1.35425 12.761719 1.65625 C 11.753719 2.74225 11.335875 4.5200313 11.296875 6.5820312 C 10.872875 5.8580312 10.290953 5.1385 9.6269531 5.0625 L 9.6152344 5.0625 C 8.4052344 4.8595 7.3678125 6.7751719 7.5078125 9.8261719 C 5.2598125 9.9071719 3.3475938 10.163375 2.0585938 10.484375 C 1.4785937 10.628375 1.1085781 10.910687 1.0175781 11.054688 C 1.0765781 11.032687 2.3306875 10.515625 7.5546875 10.515625 C 7.8606875 13.621625 9.2961719 16.480609 9.0761719 15.974609 C 8.5061719 16.876609 6.8356875 19.628219 6.3046875 21.699219 C 5.9606875 23.040219 6.0494531 23.904891 6.3144531 24.462891 C 6.6404531 25.209891 7.2768281 25.44125 7.6738281 25.53125 C 9.1388281 25.86625 10.918906 25.318969 12.753906 24.292969 C 12.312906 25.044969 11.939656 25.963656 12.222656 26.597656 C 12.650656 27.748656 14.829297 27.691922 17.404297 26.044922 C 18.586297 27.930922 19.751969 29.438719 20.667969 30.386719 C 20.817969 30.548719 20.991641 30.689734 21.181641 30.802734 C 21.482641 30.991734 21.683594 31 21.683594 31 C 21.200594 30.604 19.692531 28.772094 18.019531 25.621094 C 19.321531 24.683094 20.694656 23.3435 21.972656 21.5625 C 29.169656 21.8325 30.368531 20.111984 30.644531 19.708984 C 31.504531 18.543984 30.845156 16.344703 27.285156 14.220703 C 28.859156 14.231703 29.369406 13.784141 29.566406 13.494141 C 30.297406 12.538141 29.153703 10.705453 26.470703 9.3144531 C 27.511703 7.3464531 28.168203 5.7787187 28.533203 4.5117188 C 28.731203 3.8187187 28.598547 3.3982188 28.560547 3.3242188 C 28.459547 3.9402188 27.696781 5.9691875 25.800781 8.9921875 C 24.335781 8.3351875 22.488641 7.8146562 20.306641 7.5976562 C 19.782641 6.6046562 18.263672 3.8557187 16.763672 2.3867188 C 15.776672 1.4167187 14.985141 1.0617188 14.369141 1.0117188 L 14.367188 1.0117188 z M 15.853516 4.296875 C 16.914147 4.4561511 18.877656 7.3698438 18.964844 7.5039062 C 16.353844 7.4069062 14.653016 7.9388437 13.416016 8.7148438 C 13.533016 5.6498438 14.664297 4.2387344 15.654297 4.3027344 C 15.716172 4.2872344 15.782807 4.2862566 15.853516 4.296875 z M 10.457031 6.8886719 L 10.462891 6.8886719 C 10.799891 6.9536719 11.086594 7.2935469 11.308594 7.6855469 C 11.336594 8.3955469 11.401094 9.1281406 11.496094 9.8691406 C 10.643094 9.8191406 9.8117187 9.7959219 9.0117188 9.7949219 C 9.0067187 9.9849219 9.0040312 6.8066719 10.457031 6.8886719 z M 18.189453 8.4140625 C 20.801453 8.5700625 23.249859 9.3078906 25.005859 10.212891 C 24.587859 10.824891 24.132672 11.458234 23.638672 12.115234 C 22.423672 9.9052344 20.869391 9.5456875 20.775391 9.5546875 C 20.781391 9.5546875 22.293984 10.377313 23.208984 12.320312 C 21.011984 11.514313 18.751172 10.892891 16.451172 10.462891 C 15.685172 10.320891 14.915578 10.203375 14.142578 10.109375 C 14.138578 10.135375 14.036625 10.217781 14.015625 11.300781 C 18.578625 12.149781 22.022453 13.637344 23.814453 14.652344 C 23.857453 16.032344 23.408172 17.676453 22.326172 19.314453 C 20.884172 21.501453 19.020422 23.254312 17.357422 24.320312 C 17.034422 23.655313 16.712625 22.943547 16.390625 22.185547 C 18.924625 22.259547 20.048609 21.087281 20.099609 20.988281 C 20.099609 20.992281 18.634547 21.905031 16.435547 21.707031 C 18.230547 20.208031 19.897922 18.561156 21.419922 16.785156 C 21.929922 16.187156 22.416859 15.579891 22.880859 14.962891 C 22.859859 14.945891 22.789109 14.786766 21.912109 14.259766 C 18.883109 17.791766 15.915766 20.000781 14.134766 21.050781 C 12.928766 20.395781 11.742094 19.188266 10.871094 17.447266 C 9.6990937 15.108266 9.1134844 12.619484 9.0214844 10.646484 C 9.7424844 10.699484 10.501875 10.773047 11.296875 10.873047 C 9.990875 13.029047 10.453813 14.565672 10.507812 14.638672 C 10.507812 14.634672 10.4515 12.928484 11.6875 11.146484 C 12.2145 14.222484 13.092688 17.228516 14.304688 20.103516 C 14.358688 20.081516 14.412438 20.154141 15.398438 19.619141 C 13.855438 15.255141 13.42025 11.523031 13.40625 9.4570312 C 14.57825 8.7290313 16.229453 8.2980625 18.189453 8.4140625 z M 25.742188 10.632812 C 28.031187 12.044812 28.431641 13.747781 26.306641 13.675781 C 25.703641 13.362781 25.067156 13.070922 24.410156 12.794922 C 24.876156 12.087922 25.320188 11.366812 25.742188 10.632812 z M 24.449219 15.033203 C 26.081219 16.063203 27.214219 17.235469 27.324219 18.480469 C 27.391219 19.237469 26.850609 20.186359 22.724609 20.443359 C 24.119609 18.233359 24.501219 16.472203 24.449219 15.033203 z M 9.6640625 17.177734 C 10.880062 19.503734 12.200328 20.726062 13.486328 21.414062 C 10.744328 22.865063 8.9447187 22.585734 8.5117188 21.677734 C 8.5007188 21.665734 7.8590625 20.782734 9.6640625 17.177734 z M 15.419922 22.515625 C 15.810922 23.296625 16.216953 24.044906 16.626953 24.753906 C 14.247953 26.034906 12.592984 25.501797 13.708984 23.716797 C 14.280984 23.351797 14.852922 22.947625 15.419922 22.515625 z" />
            </svg>
          }
        >
          战网通行证登录
        </Button>
        </>
      )}
      <style jsx>{`
        .btn > img {
          width: 24px;
          height: 24px;
          margin: 0 8px 0 0;
        }
      `}</style>
    </>
  );
}
